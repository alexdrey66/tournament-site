<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AYSO Area 10W â€“ 14U Boys Standings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-main: #020617;
      --bg-card: #0f172a;
      --border-card: #1e293b;
      --text-main: #e2e8f0;
      --text-muted: #94a3b8;
      --accent-yellow: #fef08a;
      --accent-blue: #38bdf8;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    header {
      text-align: center;
      margin-bottom: 24px;
    }

    header h1 {
      margin: 0 0 6px;
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-yellow);
    }

    header p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .pool-card {
      background: var(--bg-card);
      border-radius: 12px;
      border: 1px solid var(--border-card);
      padding: 16px 14px 18px;
      margin-bottom: 18px;
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.5);
    }

    .pool-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 10px;
    }

    .pool-name {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .pool-tag {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent-blue);
    }

    .empty-text {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin: 6px 0 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    thead {
      background: #020617;
    }

    th, td {
      padding: 6px 4px;
      text-align: center;
      border-bottom: 1px solid #1f2933;
    }

    th {
      font-weight: 600;
      color: #cbd5f5;
      font-size: 0.75rem;
    }

    td.team-name {
      text-align: left;
      padding-left: 6px;
    }

    tbody tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.7);
    }

    .footer-note {
      margin-top: 10px;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: left;
    }
  </style>
</head>
<body>
<div class="page">
  <header>
    <h1>14U Boys Standings</h1>
    <p>Live pool standings, using tournament points and penalties.</p>
  </header>

  <div id="pools-container"></div>

  <p class="footer-note">
    Scoring: Win = 6 pts, Tie = 3 pts, Loss = 0 pts, Goals = 1 pt per goal (max 3 per game),
    Shutout bonus = 1 pt, Penalties are subtracted from total points.
  </p>
</div>

<script>
const TA_STORAGE_KEY = "tournament_manager_v1";
const DIVISION_ID = "14u-boys";

const WIN_POINTS = 6;
const TIE_POINTS = 3;
const LOSS_POINTS = 0;
const GOAL_POINT_PER = 1;
const GOAL_POINT_MAX = 3;
const SHUTOUT_BONUS = 1;

function loadState() {
  const raw = localStorage.getItem(TA_STORAGE_KEY);
  if (!raw) return { pools: [], teams: [], games: [] };
  try {
    return JSON.parse(raw);
  } catch {
    return { pools: [], teams: [], games: [] };
  }
}

function computeStandingsForPool(poolId, state) {
  const teams = state.teams.filter(t => t.poolId === poolId);
  const games = state.games.filter(g => g.poolId === poolId);

  const records = {};
  teams.forEach(t => {
    const penalty = t.penalty ? Number(t.penalty) : 0;
    records[t.id] = {
      teamId: t.id,
      name: t.name,
      played: 0,
      won: 0,
      drawn: 0,
      lost: 0,
      gf: 0,
      ga: 0,
      gd: 0,
      rawPoints: 0,
      penalty: Number.isFinite(penalty) ? penalty : 0,
      points: 0
    };
  });

  games.forEach(g => {
    const { teamAId, teamBId, scoreA, scoreB } = g;
    if (scoreA == null || scoreB == null) return;

    const recA = records[teamAId];
    const recB = records[teamBId];
    if (!recA || !recB) return;

    recA.played += 1;
    recB.played += 1;

    recA.gf += scoreA;
    recA.ga += scoreB;
    recB.gf += scoreB;
    recB.ga += scoreA;

    recA.gd = recA.gf - recA.ga;
    recB.gd = recB.gf - recB.ga;

    if (scoreA > scoreB) {
      recA.won += 1;
      recB.lost += 1;
      recA.rawPoints += WIN_POINTS;
      recB.rawPoints += LOSS_POINTS;
    } else if (scoreA < scoreB) {
      recB.won += 1;
      recA.lost += 1;
      recB.rawPoints += WIN_POINTS;
      recA.rawPoints += LOSS_POINTS;
    } else {
      recA.drawn += 1;
      recB.drawn += 1;
      recA.rawPoints += TIE_POINTS;
      recB.rawPoints += TIE_POINTS;
    }

    recA.rawPoints += Math.min(scoreA * GOAL_POINT_PER, GOAL_POINT_MAX);
    recB.rawPoints += Math.min(scoreB * GOAL_POINT_PER, GOAL_POINT_MAX);

    if (scoreB === 0) recA.rawPoints += SHUTOUT_BONUS;
    if (scoreA === 0) recB.rawPoints += SHUTOUT_BONUS;
  });

  Object.values(records).forEach(r => {
    r.points = r.rawPoints - r.penalty;
  });

  return Object.values(records).sort((a, b) => {
    if (b.points !== a.points) return b.points - a.points;
    if (b.gd !== a.gd) return b.gd - a.gd;
    if (b.gf !== a.gf) return b.gf - a.gf;
    return a.name.localeCompare(b.name);
  });
}

function renderDivision() {
  const state = loadState();
  const container = document.getElementById("pools-container");
  container.innerHTML = "";

  const pools = state.pools.filter(p => p.divisionId === DIVISION_ID);

  if (pools.length === 0) {
    const p = document.createElement("p");
    p.className = "empty-text";
    p.textContent = "No pools have been created yet for this division.";
    container.appendChild(p);
    return;
  }

  pools.forEach(pool => {
    const standings = computeStandingsForPool(pool.id, state);

    const card = document.createElement("div");
    card.className = "pool-card";

    const header = document.createElement("div");
    header.className = "pool-header";
    header.innerHTML = `
      <div class="pool-name">${pool.name}</div>
      <div class="pool-tag">Division: 14U Boys</div>
    `;
    card.appendChild(header);

    if (standings.length === 0) {
      const p = document.createElement("p");
      p.className = "empty-text";
      p.textContent = "No teams have been added to this pool yet.";
      card.appendChild(p);
    } else {
      const table = document.createElement("table");
      table.innerHTML = `
        <thead>
          <tr>
            <th>#</th>
            <th style="text-align:left;padding-left:6px;">Team</th>
            <th>GP</th>
            <th>W</th>
            <th>T</th>
            <th>L</th>
            <th>GF</th>
            <th>GA</th>
            <th>GD</th>
            <th>Pts</th>
            <th>Pen</th>
          </tr>
        </thead>
        <tbody>
          ${standings.map((r, idx) => `
            <tr>
              <td>${idx + 1}</td>
              <td class="team-name">${r.name}</td>
              <td>${r.played}</td>
              <td>${r.won}</td>
              <td>${r.drawn}</td>
              <td>${r.lost}</td>
              <td>${r.gf}</td>
              <td>${r.ga}</td>
              <td>${r.gd}</td>
              <td>${r.points}</td>
              <td>${r.penalty}</td>
            </tr>
          `).join("")}
        </tbody>
      `;
      card.appendChild(table);
    }

    container.appendChild(card);
  });
}

renderDivision();
</script>
</body>
</html>
