<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AYSO Tournament – Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body style="margin:0; background:#020617;">

<!-- PASSWORD GATE -->
<div id="login-screen">
  <div class="login-page">
    <div class="login-card">
      <h1>Admin Access</h1>
      <p class="login-text">
        This area is for tournament staff only. Please enter the admin password to continue.
      </p>

      <label for="admin-password">Password</label>
      <input
        id="admin-password"
        type="password"
        autocomplete="off"
        placeholder="Enter password"
        onkeydown="if(event.key==='Enter'){handleLogin();}"
      />

      <button type="button" class="login-btn" onclick="handleLogin()">Unlock Admin</button>
      <p id="login-error" class="login-error" aria-live="polite"></p>
    </div>
  </div>
</div>

<!-- MAIN ADMIN UI (HIDDEN UNTIL AUTH) -->
<div id="tournament-admin" style="display:none;">
  <div class="ta-page">
    <div class="ta-card">
      <div class="ta-header">
        <div>
          <h2>AYSO Tournament Admin</h2>
          <p class="ta-muted">
            Manage divisions, pools, teams, games, and penalties. Data is stored in this browser using localStorage.
          </p>
        </div>
        <div class="ta-header-actions">
          <span class="ta-pill">Admin</span>
          <button type="button" class="ta-lock-btn" onclick="lockAdmin()">Lock Admin</button>
        </div>
      </div>

      <!-- Division selector -->
      <div class="ta-section">
        <div class="ta-section-title">Division</div>
        <label for="ta-division">Select Division</label>
        <select id="ta-division"></select>
        <p class="ta-small-muted">
          Divisions are fixed IDs so public pages can read them:
          14U, 12U, 10U – Boys &amp; Girls.
        </p>
      </div>

      <div class="ta-grid">
        <!-- Pools -->
        <div class="ta-section">
          <div class="ta-section-title">Pools</div>
          <div class="ta-form-row">
            <input id="ta-pool-name" type="text" placeholder="Pool name (e.g., Pool A)" />
            <button type="button" onclick="taAddPool()">Add Pool</button>
          </div>
          <ul id="ta-pool-list" class="ta-list"></ul>
        </div>

        <!-- Teams -->
        <div class="ta-section">
          <div class="ta-section-title">Teams</div>
          <label for="ta-team-pool">Pool</label>
          <select id="ta-team-pool"></select>
          <div class="ta-form-row" style="margin-top:6px;">
            <input id="ta-team-name" type="text" placeholder="Team name" />
            <button type="button" onclick="taAddTeam()">Add Team</button>
          </div>
          <ul id="ta-team-list" class="ta-list"></ul>
        </div>
      </div>

      <!-- Games -->
      <div class="ta-section" style="margin-top:18px;">
        <div class="ta-section-title">Games</div>

        <div class="ta-form-grid">
          <div>
            <label for="ta-game-pool">Pool</label>
            <select id="ta-game-pool" onchange="taRenderGames()"></select>
          </div>
          <div>
            <label for="ta-game-teamA">Team A</label>
            <select id="ta-game-teamA"></select>
          </div>
          <div>
            <label for="ta-game-teamB">Team B</label>
            <select id="ta-game-teamB"></select>
          </div>
          <div>
            <label for="ta-game-datetime">Date/Time (optional)</label>
            <input id="ta-game-datetime" type="datetime-local" />
          </div>
          <div>
            <label for="ta-game-field">Field (optional)</label>
            <input id="ta-game-field" type="text" placeholder="Field" />
          </div>
        </div>

        <button type="button" class="ta-btn-primary" onclick="taAddGame()" style="margin-top:8px;">
          Add Game
        </button>

        <div id="ta-games-list" class="ta-games-list" style="margin-top:10px;"></div>
      </div>

      <div class="ta-footer">
        <button type="button" class="ta-btn-danger" onclick="taClearAll()">
          Clear All Data (this browser)
        </button>
        <span class="ta-small-muted">
          This only clears localStorage in this browser. Public pages on this same browser will update accordingly.
        </span>
      </div>
    </div>
  </div>
</div>

<style>
body {
  font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
  color: #e5e7eb;
}

/* LOGIN SCREEN */
#login-screen {
  min-height: 100vh;
  display: flex;
  align-items: stretch;
  justify-content: center;
  background: radial-gradient(circle at top, #1f2937 0, #020617 52%, #000 100%);
}

.login-page {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px 16px;
}

.login-card {
  background: #020617;
  border-radius: 14px;
  border: 1px solid #1f2937;
  max-width: 420px;
  width: 100%;
  padding: 20px 22px 22px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
}

.login-card h1 {
  margin: 0 0 8px;
  font-size: 1.4rem;
  color: #fef9c3;
}

.login-text {
  margin: 0 0 16px;
  font-size: 0.9rem;
  color: #9ca3af;
}

.login-card label {
  font-size: 0.8rem;
  color: #9ca3af;
  display: block;
  margin-bottom: 4px;
}

#admin-password {
  width: 100%;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb;
  font-size: 0.9rem;
  margin-bottom: 10px;
}

#admin-password:focus {
  outline: 1px solid #38bdf8;
  border-color: #38bdf8;
}

.login-btn {
  width: 100%;
  border-radius: 999px;
  border: none;
  padding: 8px 12px;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  background: #22c55e;
  color: #022c22;
  transition: background 0.2s ease, transform 0.08s ease;
}

.login-btn:hover {
  background: #16a34a;
  transform: translateY(-1px);
}

.login-error {
  margin: 8px 0 0;
  font-size: 0.8rem;
  color: #fecaca;
}

/* MAIN ADMIN UI */
#tournament-admin * { box-sizing: border-box; }
.ta-page { max-width: 1000px; margin: 0 auto; padding: 16px; }
.ta-card {
  background: #020617;
  border-radius: 12px;
  border: 1px solid #1f2937;
  padding: 16px;
  box-shadow: 0 18px 36px rgba(0,0,0,0.5);
}
.ta-header {
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  margin-bottom:14px;
}
.ta-header h2 {
  margin:0 0 4px;
  font-size:1.35rem;
  color:#fef9c3;
}
.ta-muted { font-size:0.8rem; color:#9ca3af; margin:0; }

.ta-header-actions {
  display:flex;
  align-items:center;
  gap:8px;
}

.ta-pill {
  border-radius:999px;
  padding:4px 10px;
  border:1px solid #f97316;
  font-size:0.7rem;
  text-transform:uppercase;
  letter-spacing:0.08em;
  color:#fed7aa;
}

.ta-lock-btn {
  border-radius:999px;
  border:1px solid #64748b;
  padding:4px 10px;
  font-size:0.75rem;
  background:#0f172a;
  color:#e5e7eb;
  cursor:pointer;
}
.ta-lock-btn:hover {
  background:#1f2937;
}

/* Sections, forms, lists */
.ta-section { margin-bottom:14px; }
.ta-section-title { font-size:0.95rem; font-weight:600; margin-bottom:4px; }
.ta-small-muted { font-size:0.75rem; color:#9ca3af; }

label { font-size:0.75rem; color:#9ca3af; display:block; margin-bottom:2px; }

input, select {
  width:100%;
  padding:6px 8px;
  border-radius:8px;
  border:1px solid #374151;
  background:#020617;
  color:#e5e7eb;
  font-size:0.85rem;
}
input:focus, select:focus {
  outline:1px solid #38bdf8;
  border-color:#38bdf8;
}

button {
  border-radius:999px;
  border:none;
  padding:6px 12px;
  font-size:0.8rem;
  cursor:pointer;
  background:#4b5563;
  color:#e5e7eb;
}
button:hover { background:#6b7280; }
.ta-btn-primary { background:#22c55e; color:#022c22; font-weight:600; }
.ta-btn-primary:hover { background:#16a34a; }
.ta-btn-danger { background:#b91c1c; color:#fee2e2; }
.ta-btn-danger:hover { background:#991b1b; }

.ta-grid {
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}
@media(min-width:850px){
  .ta-grid { grid-template-columns:1fr 1fr; }
}

.ta-form-row {
  display:flex;
  gap:6px;
  margin-bottom:8px;
}
.ta-form-row input { flex:1; }

.ta-list {
  list-style:none;
  padding:0;
  margin:0;
  max-height:200px;
  overflow-y:auto;
  border-radius:8px;
  border:1px solid #1f2937;
}
.ta-list li {
  padding:6px 8px;
  font-size:0.8rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #1f2937;
}
.ta-list li:last-child { border-bottom:none; }
.ta-list button { font-size:0.7rem; padding:4px 8px; }

.ta-form-grid {
  display:grid;
  grid-template-columns:1fr;
  gap:8px;
}
@media(min-width:850px){
  .ta-form-grid {
    grid-template-columns:repeat(3, 1fr);
  }
}

/* Games list */
.ta-games-list {
  border-radius:10px;
  border:1px solid #1f2937;
  max-height:260px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:6px;
  padding:6px;
}
.ta-game-row {
  display:grid;
  grid-template-columns:2fr 1fr 1fr;
  gap:6px;
  padding:6px 8px;
  border-radius:8px;
  background:#020617;
  border:1px solid #111827;
  font-size:0.8rem;
}
.ta-game-main { display:flex; flex-direction:column; gap:2px; }
.ta-game-meta { color:#9ca3af; font-size:0.7rem; }
.ta-game-teams { font-size:0.85rem; }
.ta-game-scores {
  display:flex;
  align-items:center;
  gap:4px;
  justify-content:flex-start;
}
.ta-game-scores input {
  width:42px;
  text-align:center;
  padding:4px 4px;
  font-size:0.8rem;
}
.ta-game-actions {
  display:flex;
  flex-direction:column;
  gap:4px;
  align-items:flex-end;
}

.ta-footer {
  margin-top:16px;
  padding-top:10px;
  border-top:1px solid #1f2937;
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
  justify-content:space-between;
}

/* Team penalty layout */
.ta-team-main {
  flex: 1;
}

.ta-team-meta {
  display: flex;
  align-items: center;
  gap: 6px;
}

.ta-team-meta label {
  margin: 0;
  font-size: 0.7rem;
  color: #9ca3af;
}

.ta-team-meta input {
  width: 60px;
  padding: 4px 6px;
  font-size: 0.8rem;
}
</style>

<script>
/* ---- Password gate logic ---- */
const ADMIN_PASSWORD = "PLAYSOCCER";
const ADMIN_UNLOCK_KEY = "tournament_admin_unlocked_v1";

function showAdminUI() {
  document.getElementById("login-screen").style.display = "none";
  document.getElementById("tournament-admin").style.display = "block";
}

function handleLogin() {
  const input = document.getElementById("admin-password");
  const error = document.getElementById("login-error");
  const value = (input.value || "").trim();

  if (!value) {
    error.textContent = "Please enter the password.";
    return;
  }

  if (value === ADMIN_PASSWORD) {
    localStorage.setItem(ADMIN_UNLOCK_KEY, "true");
    input.value = "";
    error.textContent = "";
    showAdminUI();
  } else {
    error.textContent = "Incorrect password. Please try again.";
  }
}

function lockAdmin() {
  localStorage.removeItem(ADMIN_UNLOCK_KEY);
  document.getElementById("tournament-admin").style.display = "none";
  document.getElementById("login-screen").style.display = "block";
  document.getElementById("admin-password").value = "";
  document.getElementById("login-error").textContent = "";
}

/* ---- Tournament data logic ---- */
const TA_STORAGE_KEY = "tournament_manager_v1";

let taState = {
  pools: [],   // {id, name, divisionId}
  teams: [],   // {id, name, poolId, penalty?}
  games: []    // {id, poolId, teamAId, teamBId, dateTime, field, scoreA, scoreB}
};

const TA_DIVISIONS = [
  { id: "14u-boys",  name: "14U Boys"  },
  { id: "14u-girls", name: "14U Girls" },
  { id: "12u-boys",  name: "12U Boys"  },
  { id: "12u-girls", name: "12U Girls" },
  { id: "10u-boys",  name: "10U Boys"  },
  { id: "10u-girls", name: "10U Girls" }
];

function taLoadState() {
  const raw = localStorage.getItem(TA_STORAGE_KEY);
  if (!raw) return;
  try {
    const parsed = JSON.parse(raw);
    if (parsed.pools && parsed.teams && parsed.games) {
      taState = parsed;
    }
  } catch (e) {
    console.error("Failed to parse state", e);
  }
}

function taSaveState() {
  localStorage.setItem(TA_STORAGE_KEY, JSON.stringify(taState));
}

function taInitDivisionSelect() {
  const sel = document.getElementById("ta-division");
  sel.innerHTML = "";
  TA_DIVISIONS.forEach((d, i) => {
    const opt = document.createElement("option");
    opt.value = d.id;
    opt.textContent = d.name;
    if (i === 0) opt.selected = true;
    sel.appendChild(opt);
  });
  sel.addEventListener("change", () => {
    taRenderPools();
    taSyncPoolSelectors();
    taRenderTeams();
    taRenderGames();
  });
}

function taCurrentDivisionId() {
  const sel = document.getElementById("ta-division");
  return sel.value;
}

/* Pools */
function taAddPool() {
  const nameInput = document.getElementById("ta-pool-name");
  const name = nameInput.value.trim();
  if (!name) return;
  const divisionId = taCurrentDivisionId();
  const id = "pool-" + Date.now() + "-" + Math.random().toString(36).slice(2,7);
  taState.pools.push({ id, name, divisionId });
  taSaveState();
  nameInput.value = "";
  taRenderPools();
  taSyncPoolSelectors();
}

function taDeletePool(id) {
  taState.games = taState.games.filter(g => g.poolId !== id);
  taState.teams = taState.teams.filter(t => t.poolId !== id);
  taState.pools = taState.pools.filter(p => p.id !== id);
  taSaveState();
  taRenderPools();
  taSyncPoolSelectors();
  taRenderTeams();
  taRenderGames();
}

function taRenderPools() {
  const ul = document.getElementById("ta-pool-list");
  ul.innerHTML = "";
  const divId = taCurrentDivisionId();
  const pools = taState.pools.filter(p => p.divisionId === divId);
  pools.forEach(p => {
    const li = document.createElement("li");
    li.innerHTML = `
      <span>${p.name}</span>
      <button type="button" onclick="taDeletePool('${p.id}')">Delete</button>
    `;
    ul.appendChild(li);
  });
}

function taSyncPoolSelectors() {
  const divId = taCurrentDivisionId();
  const pools = taState.pools.filter(p => p.divisionId === divId);

  const teamPoolSel = document.getElementById("ta-team-pool");
  const gamePoolSel = document.getElementById("ta-game-pool");

  [teamPoolSel, gamePoolSel].forEach(sel => {
    sel.innerHTML = "";
    pools.forEach((p, i) => {
      const opt = document.createElement("option");
      opt.value = p.id;
      opt.textContent = p.name;
      if (i === 0) opt.selected = true;
      sel.appendChild(opt);
    });
  });

  taSyncGameTeamSelectors();
}

/* Teams */
function taAddTeam() {
  const poolId = document.getElementById("ta-team-pool").value;
  if (!poolId) return;

  const nameInput = document.getElementById("ta-team-name");
  const name = nameInput.value.trim();
  if (!name) return;

  const id = "team-" + Date.now() + "-" + Math.random().toString(36).slice(2,7);
  taState.teams.push({ id, name, poolId, penalty: 0 });
  taSaveState();
  nameInput.value = "";
  taRenderTeams();
  taSyncGameTeamSelectors();
}

function taDeleteTeam(id) {
  taState.games = taState.games.filter(g => g.teamAId !== id && g.teamBId !== id);
  taState.teams = taState.teams.filter(t => t.id !== id);
  taSaveState();
  taRenderTeams();
  taRenderGames();
  taSyncGameTeamSelectors();
}

function taUpdateTeamPenalty(teamId, value) {
  const t = taState.teams.find(t => t.id === teamId);
  if (!t) return;
  const num = value === "" ? 0 : Number(value);
  if (Number.isNaN(num) || num < 0) return;
  t.penalty = num;
  taSaveState();
}

function taRenderTeams() {
  const ul = document.getElementById("ta-team-list");
  ul.innerHTML = "";
  const poolId = document.getElementById("ta-team-pool").value;
  if (!poolId) return;

  const teams = taState.teams.filter(t => t.poolId === poolId);
  teams.forEach(t => {
    const penalty = t.penalty ? Number(t.penalty) : 0;
    const li = document.createElement("li");
    li.innerHTML = `
      <div class="ta-team-main">
        <span>${t.name}</span>
      </div>
      <div class="ta-team-meta">
        <label>Penalty</label>
        <input type="number" min="0" step="1"
          value="${penalty}"
          onchange="taUpdateTeamPenalty('${t.id}', this.value)" />
        <button type="button" onclick="taDeleteTeam('${t.id}')">Delete</button>
      </div>
    `;
    ul.appendChild(li);
  });
}

/* Games */
function taSyncGameTeamSelectors() {
  const poolId = document.getElementById("ta-game-pool").value;
  const teams = taState.teams.filter(t => t.poolId === poolId);

  const selA = document.getElementById("ta-game-teamA");
  const selB = document.getElementById("ta-game-teamB");
  [selA, selB].forEach(sel => {
    sel.innerHTML = "";
    teams.forEach((t, i) => {
      const opt = document.createElement("option");
      opt.value = t.id;
      opt.textContent = t.name;
      if (i === 0) opt.selected = true;
      sel.appendChild(opt);
    });
  });
}

function taAddGame() {
  const poolId = document.getElementById("ta-game-pool").value;
  const teamAId = document.getElementById("ta-game-teamA").value;
  const teamBId = document.getElementById("ta-game-teamB").value;
  const dateTime = document.getElementById("ta-game-datetime").value || "";
  const field = document.getElementById("ta-game-field").value.trim();

  if (!poolId || !teamAId || !teamBId || teamAId === teamBId) return;

  const id = "game-" + Date.now() + "-" + Math.random().toString(36).slice(2,7);
  taState.games.push({
    id,
    poolId,
    teamAId,
    teamBId,
    dateTime: dateTime || null,
    field: field || null,
    scoreA: null,
    scoreB: null
  });
  taSaveState();

  // Keep date/time and field as-is so you can add multiple games with the same settings
  taRenderGames();
}

function taUpdateGameScore(gameId, which, value) {
  const g = taState.games.find(g => g.id === gameId);
  if (!g) return;
  const num = value === "" ? null : Number(value);
  if (Number.isNaN(num)) return;
  if (which === "A") g.scoreA = num;
  if (which === "B") g.scoreB = num;
  taSaveState();
}

function taDeleteGame(id) {
  taState.games = taState.games.filter(g => g.id !== id);
  taSaveState();
  taRenderGames();
}

function taRenderGames() {
  const container = document.getElementById("ta-games-list");
  container.innerHTML = "";
  const poolId = document.getElementById("ta-game-pool").value;
  if (!poolId) return;

  const games = taState.games.filter(g => g.poolId === poolId);
  if (games.length === 0) {
    const p = document.createElement("p");
    p.textContent = "No games for this pool yet.";
    p.className = "ta-small-muted";
    container.appendChild(p);
    return;
  }

  games.forEach(g => {
    const teamA = taState.teams.find(t => t.id === g.teamAId);
    const teamB = taState.teams.find(t => t.id === g.teamBId);
    const pool = taState.pools.find(p => p.id === g.poolId);

    const row = document.createElement("div");
    row.className = "ta-game-row";

    const dateStr = g.dateTime
      ? new Date(g.dateTime).toLocaleString([], { dateStyle: "short", timeStyle: "short" })
      : "";

    row.innerHTML = `
      <div class="ta-game-main">
        <div class="ta-game-meta">
          ${pool ? pool.name : "Pool"}${g.field ? " · " + g.field : ""}${dateStr ? " · " + dateStr : ""}
        </div>
        <div class="ta-game-teams">
          ${(teamA && teamA.name) || "Team A"}
          <span style="color:#6b7280;">vs</span>
          ${(teamB && teamB.name) || "Team B"}
        </div>
      </div>
      <div class="ta-game-scores">
        <input type="number" min="0" step="1"
          value="${g.scoreA ?? ""}"
          onchange="taUpdateGameScore('${g.id}','A', this.value)" />
        <span style="color:#e5e7eb;">-</span>
        <input type="number" min="0" step="1"
          value="${g.scoreB ?? ""}"
          onchange="taUpdateGameScore('${g.id}','B', this.value)" />
      </div>
      <div class="ta-game-actions">
        <button type="button" onclick="taDeleteGame('${g.id}')">Delete</button>
      </div>
    `;
    container.appendChild(row);
  });
}

/* Clear all */
function taClearAll() {
  if (!confirm("This will clear all tournament data stored in this browser. Continue?")) return;
  localStorage.removeItem(TA_STORAGE_KEY);
  taState = { pools: [], teams: [], games: [] };
  taRenderPools();
  taSyncPoolSelectors();
  taRenderTeams();
  taRenderGames();
}

/* Init */
function taInit() {
  taLoadState();
  taInitDivisionSelect();
  taRenderPools();
  taSyncPoolSelectors();
  taRenderTeams();
  taRenderGames();

  document.getElementById("ta-team-pool").addEventListener("change", () => {
    taRenderTeams();
    taSyncGameTeamSelectors();
  });
  document.getElementById("ta-game-pool").addEventListener("change", () => {
    taSyncGameTeamSelectors();
    taRenderGames();
  });
}

/* Boot */
(function boot() {
  const unlocked = localStorage.getItem(ADMIN_UNLOCK_KEY) === "true";
  if (unlocked) {
    showAdminUI();
  }
  taInit();
})();
</script>

</body>
</html>
