<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AYSO 10W Tournament Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
    }
    .glass {
      background: rgba(15,23,42,0.9);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(148,163,184,0.25);
    }
    .card {
      background: rgba(15,23,42,0.85);
      border-radius: 0.75rem;
      border: 1px solid rgba(51,65,85,0.7);
    }
    input, select {
      background-color: #020617;
      border-color: #1f2937;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
    }
  </style>
</head>
<body class="min-h-screen text-slate-100">
  <!-- Password gate -->
  <div id="loginOverlay" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80">
    <div class="glass rounded-2xl p-8 w-full max-w-sm shadow-2xl">
      <h1 class="text-2xl font-semibold text-center mb-4">Tournament Admin</h1>
      <p class="text-sm text-slate-300 mb-4 text-center">
        Enter the admin password to manage pools, teams, and games.
      </p>
      <label class="block text-sm mb-2" for="adminPass">Password</label>
      <input id="adminPass" type="password" class="w-full rounded-md px-3 py-2 mb-4 text-base" />
      <button id="loginBtn"
        class="w-full bg-sky-500 hover:bg-sky-400 text-sm font-semibold rounded-md py-2.5 transition">
        Log In
      </button>
      <p id="loginError" class="mt-3 text-xs text-rose-400 hidden">
        Incorrect password. Please try again.
      </p>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 py-6">
    <!-- Header -->
    <header class="mb-6 flex flex-wrap items-center justify-between gap-4">
      <div>
        <h1 class="text-3xl font-bold tracking-tight">
          AYSO Area 10W League Tournament – Admin
        </h1>
        <p class="text-sm text-slate-300 mt-1">
          Manage pools, teams, scores, and schedules. Changes sync to all division pages.
        </p>
      </div>
      <div class="flex flex-col items-end gap-1 text-sm">
        <span id="saveStatus" class="text-slate-300">
          Status: <span class="font-semibold">Loaded</span>
        </span>
        <button id="saveBtn"
          class="bg-emerald-500 hover:bg-emerald-400 text-xs font-semibold rounded-md px-4 py-2 transition">
          Save All Changes
        </button>
      </div>
    </header>

    <!-- Division selector -->
    <section class="glass rounded-2xl p-4 mb-6">
      <h2 class="text-sm font-semibold mb-3 tracking-wide text-slate-200">
        Step 1: Choose Division
      </h2>
      <div class="flex flex-wrap gap-2">
        <button data-division="14u-boys" class="division-tab px-4 py-2 rounded-full text-xs font-semibold bg-sky-500">
          14U Boys
        </button>
        <button data-division="14u-girls" class="division-tab px-4 py-2 rounded-full text-xs font-semibold bg-slate-700">
          14U Girls
        </button>
        <button data-division="12u-boys" class="division-tab px-4 py-2 rounded-full text-xs font-semibold bg-slate-700">
          12U Boys
        </button>
        <button data-division="12u-girls" class="division-tab px-4 py-2 rounded-full text-xs font-semibold bg-slate-700">
          12U Girls
        </button>
        <button data-division="10u-boys" class="division-tab px-4 py-2 rounded-full text-xs font-semibold bg-slate-700">
          10U Boys
        </button>
        <button data-division="10u-girls" class="division-tab px-4 py-2 rounded-full text-xs font-semibold bg-slate-700">
          10U Girls
        </button>
      </div>
      <p class="mt-2 text-xs text-slate-400">
        Everything below is filtered by the selected division.
      </p>
    </section>

    <!-- Steps 2–4 in three columns -->
    <div class="grid lg:grid-cols-3 gap-4 mb-6">
      <!-- Step 2: Pools -->
      <section class="glass rounded-2xl p-4">
        <h2 class="text-sm font-semibold mb-3">Step 2: Pools</h2>
        <div class="space-y-2" id="poolList"></div>
        <button id="addPoolBtn"
          class="mt-3 text-xs bg-sky-500 hover:bg-sky-400 px-3 py-1.5 rounded-md font-semibold">
          + Add Pool
        </button>
      </section>

      <!-- Step 3: Teams -->
      <section class="glass rounded-2xl p-4">
        <h2 class="text-sm font-semibold mb-3">Step 3: Teams & Deductions</h2>
        <label class="block text-xs mb-1">Pool</label>
        <select id="teamPoolSelect" class="w-full rounded-md px-3 py-2 mb-3 text-xs"></select>

        <div id="teamList" class="space-y-2"></div>

        <button id="addTeamBtn"
          class="mt-3 text-xs bg-sky-500 hover:bg-sky-400 px-3 py-1.5 rounded-md font-semibold">
          + Add Team
        </button>
        <p class="mt-3 text-[11px] text-slate-400">
          Use <span class="font-semibold">Point Deductions</span> for rules violations (sportsmanship, cards, etc.).
          These are subtracted from total points.
        </p>
      </section>

      <!-- Step 4: Games / Schedule -->
      <section class="glass rounded-2xl p-4">
        <h2 class="text-sm font-semibold mb-3">Step 4: Games & Schedule</h2>

        <!-- Top: controls & add game -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-3 text-xs">
          <div>
            <label class="block mb-1">Pool</label>
            <select id="gamePoolSelect" class="w-full rounded-md px-3 py-2"></select>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
            <div>
              <label class="block mb-1">Default Date</label>
              <input id="defaultDate" type="date" class="w-full rounded-md px-3 py-2" />
            </div>
            <div>
              <label class="block mb-1">Default Time</label>
              <input id="defaultTime" type="time" class="w-full rounded-md px-3 py-2" />
            </div>
            <div>
              <label class="block mb-1">Default Field</label>
              <input id="defaultField" type="text" placeholder="Field"
                     class="w-full rounded-md px-3 py-2" />
            </div>
          </div>
        </div>

        <button id="addGameBtn"
          class="mb-4 text-xs bg-sky-500 hover:bg-sky-400 px-3 py-1.5 rounded-md font-semibold">
          + Add Game
        </button>

        <!-- Schedule editor -->
        <h3 class="text-xs font-semibold mb-2 text-slate-200">Schedule / Edit Games</h3>
        <div id="gameList" class="space-y-3"></div>
      </section>
    </div>

    <!-- Step 5: Scores – full width, only this expands -->
    <section class="glass rounded-2xl p-4 mb-8">
      <h2 class="text-sm font-semibold mb-3">Step 5: Enter / Update Scores</h2>
      <p class="text-[11px] text-slate-400 mb-3">
        Scores are grouped by the same pool selected in <span class="font-semibold">Step 4</span>.
      </p>
      <div id="scoreList" class="space-y-2"></div>
      <p class="mt-4 text-[11px] text-slate-400">
        Scoring: Win 6 pts, Tie 3 pts, Loss 0 pts, +1 pt per goal (max 3 per game),
        +1 pt shutout bonus, minus any deductions.
      </p>
    </section>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxqNaECXvHMOWuecTtPNyMLx-ruXWum7Rofcj7pm4L8wWEKCKsQV7GM7xFhqhrzk4CX6A/exec";
    const ADMIN_PASSWORD = "PLAYSOCCER";

    let state = { pools: [], teams: [], games: [] };
    let currentDivision = "14u-boys";

    // Remember pool selections so we don't keep jumping to the first one
    let lastTeamPoolId = null;
    let lastGamePoolId = null;

    // Login overlay
    const loginOverlay = document.getElementById("loginOverlay");
    const loginBtn = document.getElementById("loginBtn");
    const loginError = document.getElementById("loginError");
    const adminPass = document.getElementById("adminPass");

    loginBtn.addEventListener("click", () => {
      if (adminPass.value.trim() === ADMIN_PASSWORD) {
        loginOverlay.classList.add("hidden");
      } else {
        loginError.classList.remove("hidden");
      }
    });

    adminPass.addEventListener("keydown", (e) => {
      if (e.key === "Enter") loginBtn.click();
    });

    const saveBtn = document.getElementById("saveBtn");
    const saveStatus = document.getElementById("saveStatus");

    const poolListEl = document.getElementById("poolList");
    const teamPoolSelect = document.getElementById("teamPoolSelect");
    const gamePoolSelect = document.getElementById("gamePoolSelect");
    const teamListEl = document.getElementById("teamList");
    const gameListEl = document.getElementById("gameList");
    const scoreListEl = document.getElementById("scoreList");
    const defaultDateEl = document.getElementById("defaultDate");
    const defaultTimeEl = document.getElementById("defaultTime");
    const defaultFieldEl = document.getElementById("defaultField");

    function uid() {
      return "id-" + Math.random().toString(36).slice(2) + Date.now().toString(36);
    }

    function setStatus(text, color = "text-slate-300") {
      saveStatus.innerHTML = `Status: <span class="font-semibold ${color}">${text}</span>`;
    }

    async function loadState() {
      try {
        setStatus("Loading…", "text-sky-300");
        const res = await fetch(API_URL + "?t=" + Date.now());
        const json = await res.json();
        state = {
          pools: Array.isArray(json.pools) ? json.pools : [],
          teams: Array.isArray(json.teams) ? json.teams : [],
          games: Array.isArray(json.games) ? json.games : []
        };
        setStatus("Loaded", "text-emerald-300");
        renderAll();
      } catch (err) {
        console.error("Load error", err);
        setStatus("Load failed", "text-rose-400");
      }
    }

    async function saveState() {
      setStatus("Saving…", "text-sky-300");
      saveBtn.disabled = true;
      try {
        await fetch(API_URL, {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify(state)
        });
        setStatus("Saved (refresh public pages to see updates)", "text-emerald-300");
      } catch (err) {
        console.error("Save error", err);
        setStatus("Save error: " + String(err), "text-rose-400");
      } finally {
        saveBtn.disabled = false;
      }
    }

    saveBtn.addEventListener("click", saveState);

    // Division tabs
    document.querySelectorAll(".division-tab").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".division-tab").forEach(b => {
          b.classList.remove("bg-sky-500");
          b.classList.add("bg-slate-700");
        });
        btn.classList.add("bg-sky-500");
        btn.classList.remove("bg-slate-700");
        currentDivision = btn.dataset.division;

        // reset remembered pools for new division
        lastTeamPoolId = null;
        lastGamePoolId = null;

        renderAll();
      });
    });

    function getDivisionPools() {
      return state.pools.filter(p => p.divisionId === currentDivision);
    }
    function getDivisionTeams() {
      return state.teams.filter(t => t.divisionId === currentDivision);
    }
    function getDivisionGames() {
      return state.games.filter(g => g.divisionId === currentDivision);
    }

    // Pools
    function renderPools() {
      const pools = getDivisionPools();
      poolListEl.innerHTML = "";
      pools.forEach(pool => {
        const row = document.createElement("div");
        row.className = "card px-3 py-2 flex flex-col sm:flex-row sm:items-center gap-2 text-sm";

        const input = document.createElement("input");
        input.type = "text";
        input.value = pool.name || "";
        input.placeholder = "Pool name (e.g., Pool A)";
        input.className = "flex-1 rounded-md px-3 py-2 text-sm";
        input.addEventListener("input", () => {
          pool.name = input.value;
        });

        const del = document.createElement("button");
        del.type = "button";
        del.className = "self-start sm:self-auto px-3 py-1.5 rounded-md bg-rose-600 hover:bg-rose-500 text-[11px]";
        del.textContent = "Delete";
        del.addEventListener("click", () => {
          state.pools = state.pools.filter(p => p.id !== pool.id);
          state.teams = state.teams.filter(t => t.poolId !== pool.id);
          state.games = state.games.filter(g => g.poolId !== pool.id);
          renderAll();
        });

        row.appendChild(input);
        row.appendChild(del);
        poolListEl.appendChild(row);
      });
    }

    document.getElementById("addPoolBtn").addEventListener("click", () => {
      state.pools.push({
        id: uid(),
        divisionId: currentDivision,
        name: "New Pool"
      });
      renderAll();
    });

    function populatePoolSelects() {
      const pools = getDivisionPools();

      const prevTeamPool = lastTeamPoolId || teamPoolSelect.value;
      const prevGamePool = lastGamePoolId || gamePoolSelect.value;

      [teamPoolSelect, gamePoolSelect].forEach(sel => {
        sel.innerHTML = "";
        pools.forEach(pool => {
          const opt = document.createElement("option");
          opt.value = pool.id;
          opt.textContent = pool.name || "(Unnamed Pool)";
          sel.appendChild(opt);
        });
      });

      const firstPoolId = pools[0] ? pools[0].id : "";

      const newTeamPool = pools.some(p => p.id === prevTeamPool) ? prevTeamPool : firstPoolId;
      const newGamePool = pools.some(p => p.id === prevGamePool) ? prevGamePool : firstPoolId;

      teamPoolSelect.value = newTeamPool;
      gamePoolSelect.value = newGamePool;

      lastTeamPoolId = newTeamPool;
      lastGamePoolId = newGamePool;
    }

    // Teams
    function renderTeams() {
      const pools = getDivisionPools();
      const teams = getDivisionTeams();
      const selectedPoolId = teamPoolSelect.value || (pools[0] && pools[0].id);

      lastTeamPoolId = selectedPoolId || null;

      if (pools.length === 0) {
        teamListEl.innerHTML = `<p class="text-xs text-slate-400">Create a pool first.</p>`;
        return;
      }

      if (!selectedPoolId) {
        teamListEl.innerHTML = "";
        return;
      }

      const filteredTeams = teams.filter(t => t.poolId === selectedPoolId);
      teamListEl.innerHTML = "";

      filteredTeams.forEach(team => {
        const row = document.createElement("div");
        row.className = "card px-3 py-2 flex flex-col sm:flex-row sm:items-center gap-3 text-sm";

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.value = team.name || "";
        nameInput.placeholder = "Team name";
        nameInput.className = "flex-1 rounded-md px-3 py-2 text-sm";
        nameInput.addEventListener("input", () => {
          team.name = nameInput.value;
        });

        const dedGroup = document.createElement("div");
        dedGroup.className = "flex items-center gap-1";

        const dedLabel = document.createElement("span");
        dedLabel.textContent = "Deductions";
        dedLabel.className = "text-[11px] text-slate-300";

        const dedInput = document.createElement("input");
        dedInput.type = "number";
        dedInput.value = team.deductions || 0;
        dedInput.min = 0;
        dedInput.className = "w-20 rounded-md px-2 py-1.5 text-sm";
        dedInput.addEventListener("input", () => {
          team.deductions = parseInt(dedInput.value || "0", 10);
        });

        dedGroup.appendChild(dedLabel);
        dedGroup.appendChild(dedInput);

        const del = document.createElement("button");
        del.type = "button";
        del.className = "self-start sm:self-auto px-3 py-1.5 rounded-md bg-rose-600 hover:bg-rose-500 text-[11px]";
        del.textContent = "Delete";
        del.addEventListener("click", () => {
          state.teams = state.teams.filter(t => t.id !== team.id);
          state.games = state.games.filter(g => g.homeTeamId !== team.id && g.awayTeamId !== team.id);
          renderAll();
        });

        row.appendChild(nameInput);
        row.appendChild(dedGroup);
        row.appendChild(del);
        teamListEl.appendChild(row);
      });
    }

    document.getElementById("addTeamBtn").addEventListener("click", () => {
      const poolId = teamPoolSelect.value;
      if (!poolId) {
        alert("Create a pool first.");
        return;
      }
      state.teams.push({
        id: uid(),
        divisionId: currentDivision,
        poolId,
        name: "New Team",
        deductions: 0
      });
      renderAll();
    });

    // Games – schedule editor (date/time/field/teams)
    function renderGames() {
      const pools = getDivisionPools();
      const teams = getDivisionTeams();
      const selectedPoolId = gamePoolSelect.value || (pools[0] && pools[0].id);

      lastGamePoolId = selectedPoolId || null;

      if (pools.length === 0) {
        gameListEl.innerHTML = `<p class="text-xs text-slate-400">Create a pool first.</p>`;
        scoreListEl.innerHTML = "";
        return;
      }

      if (!selectedPoolId) {
        gameListEl.innerHTML = "";
        scoreListEl.innerHTML = "";
        return;
      }

      const poolTeams = teams.filter(t => t.poolId === selectedPoolId);
      const games = getDivisionGames().filter(g => g.poolId === selectedPoolId);

      // Schedule cards
      gameListEl.innerHTML = "";

      games.forEach(game => {
        const card = document.createElement("div");
        card.className = "card px-3 py-3 space-y-3 text-xs";

        // Row 1: date/time/field
        const metaRow = document.createElement("div");
        metaRow.className = "grid grid-cols-1 sm:grid-cols-3 gap-2";

        const dateWrap = document.createElement("div");
        const dateLabel = document.createElement("label");
        dateLabel.className = "block text-[11px] mb-1";
        dateLabel.textContent = "Date";
        const dateInput = document.createElement("input");
        dateInput.type = "date";
        dateInput.className = "w-full rounded-md px-2 py-1.5 text-xs";
        dateInput.value = game.date || "";
        dateInput.addEventListener("input", () => game.date = dateInput.value || "");
        dateWrap.appendChild(dateLabel);
        dateWrap.appendChild(dateInput);

        const timeWrap = document.createElement("div");
        const timeLabel = document.createElement("label");
        timeLabel.className = "block text-[11px] mb-1";
        timeLabel.textContent = "Time";
        const timeInput = document.createElement("input");
        timeInput.type = "time";
        timeInput.className = "w-full rounded-md px-2 py-1.5 text-xs";
        timeInput.value = game.time || "";
        timeInput.addEventListener("input", () => game.time = timeInput.value || "");
        timeWrap.appendChild(timeLabel);
        timeWrap.appendChild(timeInput);

        const fieldWrap = document.createElement("div");
        const fieldLabel = document.createElement("label");
        fieldLabel.className = "block text-[11px] mb-1";
        fieldLabel.textContent = "Field";
        const fieldInput = document.createElement("input");
        fieldInput.type = "text";
        fieldInput.placeholder = "Fld";
        fieldInput.className = "w-full rounded-md px-2 py-1.5 text-xs";
        fieldInput.value = game.field || "";
        fieldInput.addEventListener("input", () => game.field = fieldInput.value || "");
        fieldWrap.appendChild(fieldLabel);
        fieldWrap.appendChild(fieldInput);

        metaRow.appendChild(dateWrap);
        metaRow.appendChild(timeWrap);
        metaRow.appendChild(fieldWrap);

        // Row 2: teams (no scores here)
        const vsRow = document.createElement("div");
        vsRow.className = "grid grid-cols-1 md:grid-cols-2 gap-2 items-center";

        function makeTeamSelect(labelText, value, onChange) {
          const wrap = document.createElement("div");

          const label = document.createElement("div");
          label.textContent = labelText;
          label.className = "text-[11px] mb-1 text-slate-300";

          const sel = document.createElement("select");
          sel.className = "w-full rounded-md px-2 py-1.5 text-xs";
          const emptyOpt = document.createElement("option");
          emptyOpt.value = "";
          emptyOpt.textContent = "Select team";
          sel.appendChild(emptyOpt);
          poolTeams.forEach(t => {
            const opt = document.createElement("option");
            opt.value = t.id;
            opt.textContent = t.name || "Unnamed";
            sel.appendChild(opt);
          });
          sel.value = value || "";
          sel.addEventListener("change", () => {
            onChange(sel.value || null);
            // Update score list immediately when teams change
            renderScores(poolTeams, games);
          });

          wrap.appendChild(label);
          wrap.appendChild(sel);
          return wrap;
        }

        const homeSelWrap = makeTeamSelect("Home Team", game.homeTeamId, v => game.homeTeamId = v);
        const awaySelWrap = makeTeamSelect("Away Team", game.awayTeamId, v => game.awayTeamId = v);

        vsRow.appendChild(homeSelWrap);
        vsRow.appendChild(awaySelWrap);

        // Row 3: delete button
        const actionRow = document.createElement("div");
        actionRow.className = "flex justify-end mt-1";
        const del = document.createElement("button");
        del.type = "button";
        del.className = "px-3 py-1.5 rounded-md bg-rose-600 hover:bg-rose-500 text-[11px]";
        del.textContent = "Delete Game";
        del.addEventListener("click", () => {
          state.games = state.games.filter(g => g.id !== game.id);
          renderGames();
        });
        actionRow.appendChild(del);

        card.appendChild(metaRow);
        card.appendChild(vsRow);
        card.appendChild(actionRow);

        gameListEl.appendChild(card);
      });

      // Scores list (Step 5)
      renderScores(poolTeams, games);
    }

    // Separate score editor list (Step 5)
    function renderScores(poolTeams, games) {
      const teamMap = {};
      poolTeams.forEach(t => {
        teamMap[t.id] = t.name || "Unnamed";
      });

      // Sort games by date/time to make score entry flow better
      const sortedGames = [...games].sort((a, b) => {
        const aKey = (a.date || "") + " " + (a.time || "");
        const bKey = (b.date || "") + " " + (b.time || "");
        return aKey.localeCompare(bKey);
      });

      scoreListEl.innerHTML = "";

      if (sortedGames.length === 0) {
        scoreListEl.innerHTML = `<p class="text-xs text-slate-400">No games scheduled yet.</p>`;
        return;
      }

      sortedGames.forEach(game => {
        const row = document.createElement("div");
        row.className = "card px-3 py-2 text-xs flex flex-col gap-1";

        const meta = document.createElement("div");
        meta.className = "text-[11px] text-slate-300 flex flex-wrap gap-2";
        const dateStr = game.date || "";
        const timeStr = game.time || "";
        const fieldStr = game.field || "";
        const homeName = teamMap[game.homeTeamId] || "Home TBD";
        const awayName = teamMap[game.awayTeamId] || "Away TBD";
        meta.textContent = `${dateStr} ${timeStr} ${fieldStr ? "· " + fieldStr : ""}`;

        const teamsLine = document.createElement("div");
        teamsLine.className = "text-[11px] text-slate-200";
        teamsLine.textContent = `${homeName} vs ${awayName}`;

        const scoreRow = document.createElement("div");
        scoreRow.className = "flex items-center gap-2 mt-1 flex-wrap";

        const homeLabel = document.createElement("span");
        homeLabel.textContent = "Home";
        homeLabel.className = "text-[11px]";

        const hgInput = document.createElement("input");
        hgInput.type = "number";
        hgInput.min = 0;
        hgInput.className = "w-14 rounded-md px-2 py-1 text-base text-center";
        hgInput.value = (game.homeGoals != null ? game.homeGoals : "").toString();
        hgInput.addEventListener("input", () => {
          game.homeGoals = hgInput.value === "" ? null : parseInt(hgInput.value, 10);
        });

        const dash = document.createElement("span");
        dash.textContent = "-";
        dash.className = "text-base text-slate-300";

        const awayLabel = document.createElement("span");
        awayLabel.textContent = "Away";
        awayLabel.className = "text-[11px]";

        const agInput = document.createElement("input");
        agInput.type = "number";
        agInput.min = 0;
        agInput.className = "w-14 rounded-md px-2 py-1 text-base text-center";
        agInput.value = (game.awayGoals != null ? game.awayGoals : "").toString();
        agInput.addEventListener("input", () => {
          game.awayGoals = agInput.value === "" ? null : parseInt(agInput.value, 10);
        });

        scoreRow.appendChild(homeLabel);
        scoreRow.appendChild(hgInput);
        scoreRow.appendChild(dash);
        scoreRow.appendChild(agInput);
        scoreRow.appendChild(awayLabel);

        row.appendChild(meta);
        row.appendChild(teamsLine);
        row.appendChild(scoreRow);

        scoreListEl.appendChild(row);
      });
    }

    document.getElementById("addGameBtn").addEventListener("click", () => {
      const poolId = gamePoolSelect.value;
      if (!poolId) {
        alert("Create a pool first.");
        return;
      }
      state.games.push({
        id: uid(),
        divisionId: currentDivision,
        poolId,
        homeTeamId: null,
        awayTeamId: null,
        date: defaultDateEl.value || "",
        time: defaultTimeEl.value || "",
        field: defaultFieldEl.value || "",
        homeGoals: null,
        awayGoals: null
      });
      renderGames();
    });

    function attachPoolSelectHandlers() {
      teamPoolSelect.addEventListener("change", () => {
        lastTeamPoolId = teamPoolSelect.value || null;
        renderTeams();
      });
      gamePoolSelect.addEventListener("change", () => {
        lastGamePoolId = gamePoolSelect.value || null;
        renderGames();
      });
    }

    function renderAll() {
      populatePoolSelects();
      renderPools();
      renderTeams();
      renderGames();
    }

    attachPoolSelectHandlers();
    loadState();
  </script>
</body>
</html>